# ü§ñ GitHub Actions CI/CD - Guia Para Iniciantes

**Entendendo como funcionam os testes autom√°ticos e deploy**

## üéØ O Que √â CI/CD?

**CI (Continuous Integration)**: Integra√ß√£o Cont√≠nua
- Sempre que voc√™ faz `git push`, c√≥digo √© testado automaticamente
- Previne bugs chegarem √† produ√ß√£o

**CD (Continuous Deployment)**: Deploy Cont√≠nuo  
- Se testes passam, c√≥digo √© automaticamente deployado
- Releases s√£o criados automaticamente

### Por Que Voc√™ Precisa Disso?

**Sem CI/CD** (m√©todo manual):
```bash
# Voc√™ precisa lembrar de fazer sempre:
pytest tests/
flake8 src/
docker build .
# Se esquecer algum passo ‚Üí BUG em produ√ß√£o!
```

**Com CI/CD** (autom√°tico):
```bash
git push origin main
# GitHub Actions faz TUDO automaticamente!
# Se algo der errado, voc√™ √© notificado
```

---

## üìä GitHub Actions Dashboard

### Como Acessar:

1. **GitHub Web**: Seu reposit√≥rio ‚Üí **Actions** tab
2. **Ver execu√ß√µes**: Lista de todas as execu√ß√µes
3. **Status visual**:
   - üü¢ **Verde**: Tudo OK
   - üî¥ **Vermelho**: Algo falou
   - üü° **Amarelo**: Em execu√ß√£o

### Interface Explicada:

```
GitHub ‚Üí radar-webscrapping ‚Üí Actions

üìã Workflows (lado esquerdo):
‚îú‚îÄ‚îÄ CI/CD                    # Pipeline principal
‚îú‚îÄ‚îÄ Simple CI              # Pipeline r√°pido
‚îú‚îÄ‚îÄ Dependencies            # Atualiza√ß√£o autom√°tica
‚îú‚îÄ‚îÄ Release                 # Deploy produ√ß√£o
‚îî‚îÄ‚îÄ Cleanup                 # Limpeza autom√°tica

üìä Execu√ß√µes (centro):
‚îú‚îÄ‚îÄ ‚úÖ ci-cd.yml - 15min ago  (main branch)
‚îú‚îÄ‚îÄ üî¥ ci-cd.yml - 1h ago     (feature-branch) 
‚îî‚îÄ‚îÄ üü° ci-cd.yml - Running    (main branch)
```

---

## üîç Workflows Explicados em Detalhes

### 1. **ci-cd.yml** - Pipeline Principal üöÄ

#### **Quando Executa:**
- Todo `git push` para `main` ou `develop`
- Todo Pull Request
- Tags `v*.*.*` (releases)

#### **O Que Faz (passo a passo):**

```mermaid
graph TD
    A[Push/PR detectado] --> B[Job: Lint]
    B --> C[Job: Test]
    C --> D[Job: Build]
    D --> E[Job: Integration Test]
    E --> F[Job: Security]
    F --> G[Job: Deploy?]
    G --> H[Job: Cleanup]
```

#### **Job 1: Lint (2-3 min)**
```yaml
# O que faz:
- Verifica formata√ß√£o do c√≥digo (black)
- Verifica estilo (flake8) 
- Verifica tipos (mypy)
- Verifica imports (isort)

# Se falhar:
‚ùå "Code style issues found" 
‚Üí Voc√™ precisa corrigir formata√ß√£o
```

#### **Job 2: Test (3-5 min)**
```yaml
# O que faz:
- Sobe PostgreSQL + Redis
- Instala depend√™ncias Python
- Executa pytest tests/
- Gera relat√≥rio de coverage

# Se falhar:
‚ùå "Tests failed"
‚Üí Algum teste quebrou, voc√™ precisa corrigir
```

#### **Job 3: Build (2-3 min)**
```yaml
# O que faz:
- Faz build da imagem Docker
- Testa se container sobe
- Push para GitHub Packages

# Se falhar:
‚ùå "Docker build failed"
‚Üí Problema no Dockerfile ou depend√™ncias
```

#### **Job 4: Integration Test (3-4 min)**
```yaml
# O que faz:
- Sobe container completo
- Testa se aplica√ß√£o responde
- Testa endpoints b√°sicos

# Se falhar:
‚ùå "Integration tests failed"
‚Üí Aplica√ß√£o n√£o sobe ou n√£o responde
```

#### **Job 5: Security (1-2 min)**
```yaml
# O que faz:
- Scan de vulnerabilidades (Trivy)
- Verifica depend√™ncias (Safety)
- An√°lise de c√≥digo (Bandit)

# Se falhar:
‚ùå "Security issues found"
‚Üí Vulnerabilidade encontrada
```

#### **Job 6: Deploy (s√≥ para tags)**
```yaml
# O que faz:
- Cria release no GitHub
- Faz build multi-platform
- Publica imagens Docker

# Quando executa:
- S√≥ quando voc√™ cria tag: git tag v1.0.0
```

#### **Job 7: Cleanup (1 min)**
```yaml
# O que faz:
- Remove imagens Docker antigas
- Limpa artifacts tempor√°rios

# Sempre executa no final
```

### 2. **ci-simple.yml** - Pipeline R√°pido ‚ö°

#### **Quando Executa:**
- Push/PR para `main` e `develop` (paralelo ao principal)

#### **Por Que Existe:**
- Feedback r√°pido (8-10 min vs 15-20 min)
- Testes essenciais apenas
- Para desenvolvimento √°gil

#### **O Que Faz:**
```yaml
# Vers√£o compacta:
- Setup Chrome/ChromeDriver  
- Testes b√°sicos
- Build Docker simples
- Sem security scan extenso
```

### 3. **dependencies.yml** - Atualiza√ß√£o Autom√°tica ü§ñ

#### **Quando Executa:**
- **Agendado**: Toda segunda-feira, 9h UTC
- **Manual**: Voc√™ pode executar quando quiser

#### **O Que Faz:**
```yaml
# 1. Verifica atualiza√ß√µes dispon√≠veis
pip list --outdated

# 2. Atualiza requirements.txt
pip-compile requirements.in

# 3. Testa se tudo funciona
pytest tests/

# 4. Cria PR autom√°tico
gh pr create --title "chore: update dependencies"
```

#### **Resultado:**
- ü§ñ PR autom√°tico com atualiza√ß√µes
- ‚úÖ Voc√™ revisa e faz merge se OK
- üõ°Ô∏è Mant√©m projeto seguro e atualizado

### 4. **release.yml** - Deploy de Produ√ß√£o üöÄ

#### **Quando Executa:**
- Quando voc√™ cria tag: `git tag v1.0.0`
- Manual (para emerg√™ncias)

#### **O Que Faz:**
```yaml
# 1. Valida√ß√£o pr√©-release
- Verifica formato da vers√£o
- Testa build completo

# 2. Build multi-platform  
- Docker para AMD64 + ARM64
- Testes em diferentes arquiteturas

# 3. Publica release
- Cria release no GitHub
- Upload das imagens Docker
- Gera changelog autom√°tico

# 4. Notifica integra√ß√£o
- Webhook para radar-infra
- Notifica√ß√£o de nova vers√£o
```

### 5. **cleanup.yml** - Manuten√ß√£o üßπ

#### **Quando Executa:**
- **Agendado**: Todo domingo, 2h UTC
- **Manual**: Quando reposit√≥rio ficar "pesado"

#### **O Que Faz:**
```yaml
# Limpeza autom√°tica:
- Remove cache antigo (>7 dias)
- Remove imagens Docker antigas (>30 dias)  
- Remove artifacts antigos (>90 dias)
- Health check do reposit√≥rio
```

---

## üîî Entendendo Notifica√ß√µes

### Quando Voc√™ Recebe Email:

#### ‚ùå **Workflow Falhou**
```
Subject: [radar-webscrapping] Run failed: CI/CD - main (a1b2c3d)

Your workflow run "CI/CD" has failed.
View details: https://github.com/...
```

**O que fazer:**
1. Clique no link para ver detalhes
2. Identifique qual job falhou
3. Leia os logs de erro
4. Corrija o problema
5. Fa√ßa novo push

#### ‚úÖ **Workflow Passou (primeira vez ap√≥s falha)**
```
Subject: [radar-webscrapping] Run completed: CI/CD - main (a1b2c3d)

Your workflow run "CI/CD" has completed successfully.
```

#### ü§ñ **Dependabot PR Criado**
```
Subject: [radar-webscrapping] New PR: Update dependencies

Dependabot has created a new pull request to update your dependencies.
Review: https://github.com/...
```

### Como Configurar Notifica√ß√µes:

```bash
# GitHub Settings ‚Üí Notifications
# Customize para receber apenas:
‚òëÔ∏è Failures (falhas)
‚òëÔ∏è First success after failure  
‚òê All workflow runs (muito spam)
```

---

## üîç Interpretando Logs de Erro

### Cen√°rio 1: Lint Falhou

#### **Log de Erro:**
```
Run flake8 src/
src/scrapers/curso_scraper.py:45:80: E501 line too long (85 > 79 characters)
src/scrapers/curso_scraper.py:52:1: F401 'requests' imported but unused
##[error]Process completed with exit code 1
```

#### **Como Corrigir:**
```bash
# Localmente:
docker-compose exec webscrapping flake8 src/
docker-compose exec webscrapping black src/  # Auto-format

# Commit e push novamente
git add .
git commit -m "fix: corrigir problemas de linting"
git push origin main
```

### Cen√°rio 2: Testes Falharam

#### **Log de Erro:**
```
FAILED tests/test_curso_scraper.py::test_buscar_cursos - AssertionError: assert [] == ['MAT001', 'MAT002']
>       assert resultado == expected
E       assert [] == ['MAT001', 'MAT002']
```

#### **Como Corrigir:**
```bash
# Debug local:
docker-compose exec webscrapping pytest tests/test_curso_scraper.py::test_buscar_cursos -v

# Corrigir c√≥digo ou teste
# Commit e push
```

### Cen√°rio 3: Docker Build Falhou

#### **Log de Erro:**
```
Step 8/15 : RUN pip install -r requirements.txt
ERROR: Could not find a version that satisfies the requirement unknown-package==1.0.0
##[error]Process completed with exit code 1
```

#### **Como Corrigir:**
```bash
# Verificar requirements.txt
# Corrigir depend√™ncia problem√°tica
# Testar build local:
docker build -t test .

# Commit e push
```

---

## üéØ Workflow de Desenvolvimento

### Cen√°rio Completo: "Implementar nova feature"

#### **Dia 1 - Come√ßar Feature**

```bash
# 1. Criar branch
git checkout -b feature/nova-funcionalidade

# 2. Desenvolver...
# (seus c√≥digos)

# 3. Commit inicial
git add .
git commit -m "feat: iniciar implementa√ß√£o nova funcionalidade"
git push origin feature/nova-funcionalidade
```

**GitHub Actions:**
- ‚úÖ Executa `ci-cd.yml` na sua branch
- ‚úÖ Feedback em ~15 minutos
- ‚ùå Se falhar, corrige e push novamente

#### **Dia 2 - Continuar Feature**

```bash
# 4. Mais desenvolvimento...
git add .
git commit -m "feat: adicionar l√≥gica de valida√ß√£o"
git push origin feature/nova-funcionalidade
```

**GitHub Actions:**
- ‚úÖ Testa novamente
- ‚úÖ Build da sua branch

#### **Dia 3 - Finalizar Feature**

```bash
# 5. Testes finais locais
docker-compose exec webscrapping pytest tests/

# 6. Commit final
git add .
git commit -m "feat: finalizar nova funcionalidade com testes"
git push origin feature/nova-funcionalidade

# 7. Criar Pull Request
# GitHub ‚Üí Compare & pull request
```

**GitHub Actions:**
- ‚úÖ Executa testes no PR
- ‚úÖ Status aparece no PR
- ‚úÖ S√≥ permite merge se CI passou

#### **Dia 4 - Merge e Deploy**

```bash
# 8. Merge no GitHub (s√≥ se CI passou)
# GitHub ‚Üí Merge pull request

# 9. Limpar localmente
git checkout main
git pull origin main
git branch -d feature/nova-funcionalidade

# 10. Para deploy em produ√ß√£o (opcional)
git tag v1.0.0
git push origin v1.0.0
```

**GitHub Actions:**
- ‚úÖ `ci-cd.yml` executa no main
- ‚úÖ `release.yml` executa na tag
- ‚úÖ Deploy autom√°tico para produ√ß√£o

---

## üõ†Ô∏è Comandos √öteis para CI/CD

### GitHub CLI (Opcional, mas √∫til):

#### **Instala√ß√£o:**
```bash
# Windows (via Chocolatey)
choco install gh

# Ou baixar: https://cli.github.com/
```

#### **Comandos √öteis:**
```bash
# Ver workflows
gh workflow list

# Executar workflow manualmente
gh workflow run ci-cd.yml

# Ver execu√ß√µes recentes
gh run list

# Ver detalhes de execu√ß√£o
gh run view [run-id]

# Ver logs de falha
gh run view [run-id] --log-failed
```

### Executar GitHub Actions Localmente:

#### **Com act (Simulador local):**
```bash
# Instalar act
# https://github.com/nektos/act

# Executar workflow localmente
act push                    # Simular push
act -j lint                # Executar job espec√≠fico
act --list                 # Ver a√ß√µes dispon√≠veis
```

---

## üìä Monitoramento e M√©tricas

### M√©tricas Importantes:

#### **Build Time**
- **Objetivo**: < 15 minutos para CI/CD completo
- **Atual**: ~12-18 minutos (dentro do esperado)
- **Como melhorar**: Cache de depend√™ncias

#### **Success Rate**
- **Objetivo**: > 95%
- **Monitor**: GitHub Insights ‚Üí Actions

#### **Coverage**
- **Objetivo**: > 80%
- **Monitor**: Relat√≥rios de coverage nos logs

### Como Acompanhar:

#### **GitHub Insights:**
```
Seu repo ‚Üí Insights ‚Üí Actions
- Build times
- Success rates  
- Most failing workflows
```

#### **Logs Estruturados:**
```bash
# Ver m√©tricas nos logs
grep "duration" logs/github-actions.log
grep "coverage" logs/test-coverage.log
```

---

## üö® Troubleshooting Comum

### Problema 1: "CI demora muito"

#### **Sintomas:**
- Workflows levam > 25 minutos
- Timeout em jobs

#### **Solu√ß√µes:**
```yaml
# 1. Verificar cache
- uses: actions/cache@v3
  with:
    path: ~/.cache/pip
    key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}

# 2. Paralelizar jobs
jobs:
  lint:
    runs-on: ubuntu-latest
  test:
    runs-on: ubuntu-latest  
    # Jobs executam em paralelo

# 3. Reduzir escopo de testes em PR
if: github.event_name == 'pull_request'
```

### Problema 2: "Testes passam local, falham CI"

#### **Causas Comuns:**
- Diferen√ßas de ambiente
- Timezone diferente
- Depend√™ncias n√£o pinadas

#### **Solu√ß√µes:**
```bash
# 1. Testar com mesmo ambiente
docker run --rm -it python:3.11-slim bash
pip install -r requirements.txt
pytest tests/

# 2. Pinar depend√™ncias
pip freeze > requirements.txt

# 3. Usar fixtures determin√≠sticas
@pytest.fixture
def fixed_datetime():
    return datetime(2024, 1, 1, 12, 0, 0, tzinfo=timezone.utc)
```

### Problema 3: "Deploy falha"

#### **Log t√≠pico:**
```
Error: buildx failed with: ERROR: failed to push
permission denied
```

#### **Solu√ß√µes:**
```bash
# 1. Verificar permiss√µes GitHub
# Settings ‚Üí Actions ‚Üí General ‚Üí Workflow permissions
‚òëÔ∏è Read and write permissions

# 2. Verificar secrets
# Settings ‚Üí Secrets and variables ‚Üí Actions
# GITHUB_TOKEN deve existir (autom√°tico)

# 3. Verificar tag format
git tag v1.0.0  # Correto: v + semantic version
git tag 1.0.0   # Incorreto: sem 'v'
```

---

## üéì Boas Pr√°ticas

### Para Commits:

#### **Sempre:**
```bash
# Commits pequenos e focados
git commit -m "feat: adicionar valida√ß√£o de URL"
git commit -m "test: adicionar teste para valida√ß√£o"
git commit -m "docs: atualizar README com nova funcionalidade"
```

#### **Nunca:**
```bash
# Commits gigantes
git commit -m "implementar tudo"  # ‚ùå

# Commits sem descri√ß√£o
git commit -m "fix"  # ‚ùå

# Commits que quebram CI
git commit -m "WIP - n√£o funciona ainda"  # ‚ùå
```

### Para Branches:

#### **Nomenclatura:**
```bash
feature/nova-funcionalidade     # ‚úÖ
bugfix/corrigir-scraper        # ‚úÖ
hotfix/vulnerabilidade-critica # ‚úÖ

fix                            # ‚ùå muito gen√©rico
jamil-branch                   # ‚ùå nome pessoal
```

### Para Pull Requests:

#### **Sempre incluir:**
- Descri√ß√£o clara do que mudou
- Por que mudou
- Como testar
- Screenshots (se UI)
- Links para issues relacionadas

---

## üéØ Pr√≥ximos Passos

### Semana 1: Familiariza√ß√£o
- [ ] Fazer primeiro push e ver CI executar
- [ ] Propositalmente quebrar teste e ver falha
- [ ] Corrigir e ver CI passar
- [ ] Entender logs de cada job

### Semana 2: Dom√≠nio
- [ ] Trabalhar com branches e PRs
- [ ] Configurar notifica√ß√µes
- [ ] Usar GitHub CLI
- [ ] Otimizar tempo de CI

### Semana 3: Maestria
- [ ] Customizar workflows
- [ ] Adicionar novos checks
- [ ] Configurar deploy autom√°tico
- [ ] Monitorar m√©tricas

---

**üéâ Agora voc√™ entende todo o sistema de CI/CD!**

**Lembre-se:**
- ‚úÖ GitHub Actions √© seu amigo - ele previne bugs
- ‚úÖ CI/CD economiza seu tempo a longo prazo
- ‚úÖ Sempre corrija problemas de CI imediatamente
- ‚úÖ Use branches para features grandes
- ‚úÖ Confie no processo - ele funciona!

**Desenvolvimento seguro e automatizado! üöÄ**